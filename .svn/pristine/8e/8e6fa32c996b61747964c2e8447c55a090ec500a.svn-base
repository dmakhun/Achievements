package com.softserve.edu.dao;

import java.util.List;

import javax.persistence.EntityManager;
import javax.persistence.NoResultException;
import javax.persistence.PersistenceContext;

import org.springframework.stereotype.Repository;

@Repository
public class GenericDaoImplementation<T> implements GenericDao<T> {

	private Class<T> objectClass;

	@PersistenceContext
	EntityManager entityManager;

	public GenericDaoImplementation() {

	}

	/**
	 * This is the place where generic magically becomes a concrete object, in
	 * some cases.
	 * 
	 * @param objectClass
	 *            Class type, that will be returned in some cases.
	 */
	public GenericDaoImplementation(Class<T> objectClass) {
		this.objectClass = objectClass;
	}

	/**
	 * {@inheritDoc}
	 */

	public boolean save(T item) {
		boolean status = false;
		entityManager.persist(item);
		status = true;
		return status;
	}

	/**
	 * {@inheritDoc}
	 */

	public boolean update(T item) {
		boolean status = false;
		entityManager.merge(item);
		status = true;

		return status;
	}

	/**
	 * {@inheritDoc}
	 */

	public T getByID(Long id) {

		return entityManager.find(objectClass, id);

	}


	/**
	 * {@inheritDoc}
	 * 
	 */
	@SuppressWarnings("unchecked")
	@Override
	public T getByUuid(String uuid) {

		try {
			if (uuid == null || uuid.isEmpty()) {
				return null;
			}

			T t = (T) entityManager
					.createQuery(
							"from " + objectClass.getSimpleName()
									+ " where uuid like :uuid")
					.setParameter("uuid", uuid).getSingleResult();

			return t;
		} catch (NoResultException e) {
			return null;
		}
	}


	/**
	 * {@inheritDoc}
	 */

	@SuppressWarnings("unchecked")
	public List<T> getAll() {
		return entityManager.createQuery("from " + objectClass.getName())
				.getResultList();
	}

	/**
	 * {@inheritDoc}
	 */

	public boolean delete(T item) {
		boolean status = false;
		T eT = entityManager.merge(item);
		entityManager.remove(eT);
		status = true;
		return status;
	}

}
