package com.softserve.edu.manager;

import java.util.Calendar;
import java.util.LinkedHashMap;
import java.util.List;
import java.util.Map;

import com.softserve.edu.dao.ScheduleGroupDao;
import com.softserve.edu.entity.Schedule;

/**
 * 
 * @author edgar
 * 
 */
public class ScheduleManagerImplementation implements ScheduleManager {

	/*
	 * (non-Javadoc)
	 * 
	 * @see com.softserve.edu.manager.IScheduleManager#table(java.util.Calendar,
	 * java.lang.String)
	 */
	public Map<Long, String> table(Calendar calendar, String group) {
		Long placeOfText = 0l;
		Map<Long, String> map = new LinkedHashMap<Long, String>();
		ScheduleRowsManagerImplementation sr = new ScheduleRowsManagerImplementation(calendar);
		List<Calendar> calen = sr.getWeek();
		ScheduleGroupDao sgd = new ScheduleGroupDao(group);
		List<Schedule> schList = sgd.listScheduleForGroup;
		for (Calendar c : calen) {
			++placeOfText;
			int m = c.get(Calendar.MONTH);
			int d = c.get(Calendar.DAY_OF_MONTH);
			int h = c.get(Calendar.HOUR_OF_DAY);

			for (Schedule s : schList) {
				if (s.getStartDateAndTime().get(Calendar.MONTH) == m
						&& s.getStartDateAndTime().get(Calendar.DAY_OF_MONTH) == d
						&& s.getStartDateAndTime().get(Calendar.HOUR_OF_DAY) == h) {

					map.put(placeOfText,
							s.getMeetType() + " " + s.getLocation());
					Calendar calendarTemp = s.getStartDateAndTime();
					calendarTemp.add(Calendar.HOUR_OF_DAY, 1);

					Long temp = placeOfText;
					while (calendarTemp.before(s.getEndDateAndTime())) {
						map.put(++temp, s.getMeetType() + " " + s.getLocation());
						calendarTemp.add(Calendar.HOUR_OF_DAY, 1);
					}

				}

			}
		}
		return map;
	}

}
